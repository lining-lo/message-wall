## 留言墙项目笔记

### 文档

- [Vite](https://vitejs.cn/vite5-cn/guide/)
- [Vue Router](https://router.vuejs.org/zh/guide/)
- [Element Plus](https://element-plus.org/zh-CN/#/zh-CN)
- [Vuex](https://vuex.vuejs.org/zh/)
- [Vant](https://vant-ui.github.io/vant/#/zh-CN)
- [Echarts](https://echarts.apache.org/zh/index.html)

### 目录

* [1. 项目初始化](#1-项目初始化)
* [2. 编写入口文件](#2-编写入口文件)
* [3. 创建数据库](#3-创建数据库)

#### 1. 项目初始化

```
1 初始化项目：npm install express --save
2 项目目录
	|-- serve/
		|-- jsconfig.json
		|-- index.js
		|-- 笔记.md
		|-- config/
		|	|-- default.js
		|-- controller/
		|-- lib/
		|	|-- db.js
		|-- routes/   
3 安装插件
	下载 mysql 插件（连接数据库）：npm install mysql --save
	下载 multer 插件（上传图片）：npm install multer --save
	下载 ejs 插件（解析 html）：npm install ejs --save
```

#### 2. 编写入口文件

```
1 入口模板：
    //引入express
    const express = require('express')
    //引入path
    const path = require('path')
    //引入ejs
    const ejs = require('ejs')
    //引入cors
    const cors = require('cors')
    //引入配置文件
    const config = require('./config/default')

    //创建express实例
    const app = express()

    //解析数据
    app.use(express.json())
    app.use(express.urlencoded({ extended: true }))

    //解决跨域
    app.use(cors())

    //引入路由
    require('./routes/index')(app)
    require('./routes/files')(app)

    //设置静态资源位置
    app.use(express.static(__dirname + '/views'))
    app.use(express.static(__dirname + '/data'))

    //加入html视图
    app.engine('html', ejs.__express)
    app.set('view engine', 'html')

    //监听端口，启动项目
    app.listen(config.port, () => {
        console.log(`${config.port}端口监听中，项目启动`);
    })

2 启动项目：nodemon index
```

#### 3. 创建数据库

```
1 数据库表设计
	留言/相片：ID、类型（0为留言、1为相片）、内容、名称、创建者ID、创建日期、标签、颜色、路径
	留言反馈：ID、留言ID、反馈者ID、反馈类型（0为喜欢、1为举报、2为撤销）、时间
	留言评论：ID、留言ID、评论者ID、评论者名称、评论者头像、评论内容、时间
2 数据库的调用：lib/db.js --> controller/dbServer.js --> routes/index.js
3 nodejs 连接 mysql --> https://www.runoob.com/nodejs/nodejs-mysql.html
3 问题：连接 mysql：Error: connect ECONNREFUSED ::1:3306 at TCPConnectWrap
	解决方法：host: 'localhost' 改成 host: '127.0.0.1'
	参考文章：https://segmentfault.com/a/1190000046306756
```

#### 4. 实现后端接口

```
1 使用 cros 解决跨域问题（之前手动设置请求头解决跨域会报错）
	参考文章：https://www.javascriptcn.com/interview-nodejs/677df5a96bd1fcbf6a934d8c.html
	步骤：① 安装依赖：npm install cors --save
		 ② 使用：app.use(cors()) --> 注意：必要写在路由之前
	自定义 CORS 配置：
        app.use(cors({
          origin: 'https://example.com', // 允许的源
          methods: ['GET', 'POST', 'PUT', 'DELETE'], // 允许的 HTTP 方法
          allowedHeaders: ['Content-Type', 'Authorization'], // 允许的请求头
        }));
2 axios 发送 get 请求：
    const test = () => {
        axios.get('http://localhost:3000/findWallPage', {
            params: {
                label: -1,
                type: 0,
                page: 1,
                pagesize: 2
            }
        }).then(result => {
            console.log(result);
        })
    }
3 axios 发送 post 请求：
    const test = () => {
        const data = {
            id: 2
        }
        axios.post('http://localhost:3000/deleteComment', data).then(result => {
            console.log(result);
        })
    }
4 express 接收 post 请求 --> request.body
5 express 接收 get 请求 --> request.query（接收到的参数都是字符串，可以用 parseInt 转化成数字）
```

