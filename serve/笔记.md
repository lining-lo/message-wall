## 留言墙项目笔记

### 文档

- [Vite](https://vitejs.cn/vite5-cn/guide/)
- [Vue Router](https://router.vuejs.org/zh/guide/)
- [Element Plus](https://element-plus.org/zh-CN/#/zh-CN)
- [Vuex](https://vuex.vuejs.org/zh/)
- [Vant](https://vant-ui.github.io/vant/#/zh-CN)
- [Echarts](https://echarts.apache.org/zh/index.html)

### 目录

* [1. 项目初始化](#1-项目初始化)
* [2. 编写入口文件](#2-编写入口文件)
* [3. 创建数据库](#3-创建数据库)

#### 1. 项目初始化

```
1 初始化项目：npm install express --save
2 项目目录
	|-- serve/
		|-- jsconfig.json
		|-- index.js
		|-- 笔记.md
		|-- config/
		|	|-- default.js
		|-- controller/
		|-- lib/
		|	|-- db.js
		|-- routes/   
3 安装插件
	下载 mysql 插件（连接数据库）：npm install mysql --save
	下载 multer 插件（上传图片）：npm install multer --save
	下载 ejs 插件（解析 html）：npm install ejs --save
```

#### 2. 编写入口文件

```
1 入口模板：
    //引入express
    const express = require('express')
    //引入path
    const path = require('path')
    //引入ejs
    const ejs = require('ejs')
    //引入配置文件
    const config = require('./config/default')

    //创建express实例
    const app = express()

    //引入路由
    require('./routes/index')(app)
    require('./routes/files')(app)

    //设置静态资源位置
    app.use(express.static(__dirname + '/views'))
    app.use(express.static(__dirname + '/data'))

    //解析数据
    app.use(express.json())
    app.use(express.urlencoded({ extended: true }))

    //加入html视图
    app.engine('html', ejs.__express)
    app.set('view engine', 'html')

    //设置允许跨域访问该服务
    app.all('*', function (req, res, next) {
        //允许访问ip *为所有
        res.header("Access-Control-Allow-Origin", "*");
        res.header("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
        res.header("Access-Control-Allow-Credentials", "true");
        res.header("Access-Control-Allow-Methods", "PUT,POST,GET,DELETE,OPTIONS");
        req.header("X-Powered-By", '3.2.1')

        //这段仅仅为了方便返回json而已
        res.header("Content-Type", "application/json;charset=utf-8");
        if (req.method == 'OPTIONS') {
            //让options请求快速返回
            res.sendStatus(200);
        } else {
            next();
        }
    });

    //监听端口，启动项目
    app.listen(config.port, () => {
        console.log(`${config.port}端口监听中，项目启动`);
    })

2 启动项目：nodemon index
```

#### 3. 创建数据库

```
1 数据库表设计
	留言/相片：ID、类型（0为留言、1为相片）、内容、名称、创建者ID、创建日期、标签、颜色、路径
	留言反馈：ID、留言ID、反馈者ID、反馈类型（0为喜欢、1为举报、2为撤销）、时间
	留言评论：ID、留言ID、评论者ID、评论者名称、评论者头像、评论内容、时间
2 数据库的调用：lib/db.js --> controller/dbServer.js --> routes/index.js
3 nodejs 连接 mysql --> https://www.runoob.com/nodejs/nodejs-mysql.html
3 问题：连接 mysql：Error: connect ECONNREFUSED ::1:3306 at TCPConnectWrap
	解决方法：host: 'localhost' 改成 host: '127.0.0.1'
	参考文章：https://segmentfault.com/a/1190000046306756
```

